/*!
 *
 * jQuery collagePlus Plugin v0.2.0
 * https://github.com/ed-lea/jquery-collagePlus
 *
 * Copyright 2012, Ed Lea twitter.com/ed_lea
 *
 * built for http://qiip.me
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 *
 */
;(function(a){a.fn.collagePlus=function(c){function e(z,k,g){var A=g.padding*(z.length-1)+z.length*z[0][3],j=g.albumWidth-A,y=j/(k-A),x=A;for(var v=0;v<z.length;v++){var m=a(z[v][0]),w=Math.floor(z[v][1]*y),q=Math.floor(z[v][2]*y),i=!!(v<z.length-1);x+=w;if(!i&&x<g.albumWidth){w=w+(g.albumWidth-x)}if(m.is("img")){m.width(w)}else{m.width(w+z[v][3]);m.find("img").width(w)}if(m.is("img")){m.height(q)}else{m.height(q+z[v][4]);m.find("img").height(q)}b(m,i,g);m.animate({opacity:"1"},{duration:g.fadeSpeed})}}function b(i,g,j){var h={"margin-bottom":j.padding+"px","margin-right":g?j.padding+"px":"0px",display:j.display,"vertical-align":"bottom",overflow:"hidden"};return i.css(h)}function d(g){$img=a(g);var h=new Array;h.w=parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width"));h.h=parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width"));return h}var f=a.extend({targetHeight:400,albumWidth:this.width(),padding:parseFloat(this.css("padding-left")),images:this.children(),fadeSpeed:"fast",display:"inline-block"},c);return this.each(function(){var h=0,g=[];f.images.each(function(r){var k=a(this),j=k.is("img")?k:a(this).find("img");var n=typeof j.data("width")!="undefined"?j.data("width"):j.width(),i=typeof j.data("height")!="undefined"?j.data("height"):j.height();var s=d(j);j.data("width",n);j.data("height",i);var m=Math.ceil(n/i*f.targetHeight),q=Math.ceil(f.targetHeight);g.push([this,m,q,s.w,s.h]);h+=m+s.w+f.padding;if(h>f.albumWidth&&g.length!=0){e(g,h-f.padding,f);delete h;delete g;h=0;g=[]}if(f.images.length-1==r&&g.length!=0){e(g,h,f);delete h;delete g;h=0;g=[]}})})}})(jQuery);