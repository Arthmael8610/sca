(function(h){var f={serverPath:"./src/plugins/upload/trumbowyg.upload.php",fileFieldName:"fileToUpload",data:[],headers:{},xhrFields:{},urlPropertyName:"file",statusPropertyName:"success",success:undefined,error:undefined};function e(c,d){var a=d.shift(),b=d;if(c!==null){if(b.length===0){return c[a]}if(typeof c==="object"){return e(c[a],b)}}return c}g();h.extend(true,h.trumbowyg,{langs:{en:{upload:"Upload",file:"File",uploadError:"Error"},sk:{upload:"Nahrať",file:"Súbor",uploadError:"Chyba"},fr:{upload:"Envoi",file:"Fichier",uploadError:"Erreur"},cs:{upload:"Nahrát obrázek",file:"Soubor",uploadError:"Chyba"},zh_cn:{upload:"上传",file:"文件",uploadError:"错误"},ru:{upload:"Загрузка",file:"Файл",uploadError:"Ошибка"}},plugins:{upload:{init:function(b){b.o.plugins.upload=h.extend(true,{},f,b.o.plugins.upload||{});var a={fn:function(){b.saveRange();var d,c=b.o.prefix;var j=b.openModalInsert(b.lang.upload,{file:{type:"file",required:true,attributes:{accept:"image/*"}},alt:{label:"description",value:b.getRangeText()}},function(l){var i=new FormData();i.append(b.o.plugins.upload.fileFieldName,d);b.o.plugins.upload.data.map(function(k){i.append(k.name,k.value)});if(h("."+c+"progress",j).length===0){h("."+c+"modal-title",j).after(h("<div/>",{"class":c+"progress"}).append(h("<div/>",{"class":c+"progress-bar"})))}h.ajax({url:b.o.plugins.upload.serverPath,headers:b.o.plugins.upload.headers,xhrFields:b.o.plugins.upload.xhrFields,type:"POST",data:i,cache:false,dataType:"json",processData:false,contentType:false,progressUpload:function(k){h("."+c+"progress-bar").stop().animate({width:Math.round(k.loaded*100/k.total)+"%"},200)},success:function(k){if(b.o.plugins.upload.success){b.o.plugins.upload.success(k,b,j,l)}else{if(!!e(k,b.o.plugins.upload.statusPropertyName.split("."))){var n=e(k,b.o.plugins.upload.urlPropertyName.split("."));b.execCmd("insertImage",n);h('img[src="'+n+'"]:not([alt])',b.$box).attr("alt",l.alt);setTimeout(function(){b.closeModal()},250);b.$c.trigger("tbwuploadsuccess",[b,k,n])}else{b.addErrorOnModalField(h("input[type=file]",j),b.lang[k.message]);b.$c.trigger("tbwuploaderror",[b,k])}}},error:b.o.plugins.upload.error||function(){b.addErrorOnModalField(h("input[type=file]",j),b.lang.uploadError);b.$c.trigger("tbwuploaderror",[b])}})});h("input[type=file]").on("change",function(i){try{d=i.target.files[0]}catch(l){d=i.target.value}})}};b.addBtnDef("upload",a)}}}});function g(){if(!h.trumbowyg&&!h.trumbowyg.addedXhrProgressEvent){var a=h.ajaxSettings.xhr;h.ajaxSetup({xhr:function(){var b=a(),c=this;if(b&&typeof b.upload==="object"&&c.progressUpload!==undefined){b.upload.addEventListener("progress",function(d){c.progressUpload(d)},false)}return b}});h.trumbowyg.addedXhrProgressEvent=true}}})(jQuery);