(function(g){function e(a){var c="";for(var b=a.length-1;b>=0;b-=1){c+=a.charAt(b)}return c}function h(a){var b=a;b=b.replace(/<[^> ]*/g,function(c){return c.toLowerCase()});b=b.replace(/<[^>]*>/g,function(c){c=c.replace(/ [^=]+=/g,function(d){return d.toLowerCase()});return c});b=b.replace(/<[^>]*>/g,function(c){c=c.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return c});return b}function f(b,i){var j="";var r="";var a;var s;var t;for(a=0;i.charAt(a)===b.charAt(a);a+=1){j+=i.charAt(a)}for(var d=a;d>=0;d-=1){if(b.charAt(d)==="<"){a=d;j=b.substring(0,a);break}else{if(b.charAt(d)===">"){break}}}i=e(i);b=e(b);for(s=0;i.charAt(s)===b.charAt(s);s+=1){r+=i.charAt(s)}for(var q=s;q>=0;q-=1){if(b.charAt(q)===">"){s=q;r=b.substring(0,s);break}else{if(b.charAt(q)==="<"){break}}}r=e(r);if(a===(i.length-s)){return false}i=e(i);t=i.substring(a,i.length-s);t=h(t);t=t.replace(/<b(\s+|>)/g,"<strong$1");t=t.replace(/<\/b(\s+|>)/g,"</strong$1");t=t.replace(/<i(\s+|>)/g,"<em$1");t=t.replace(/<\/i(\s+|>)/g,"</em$1");t=t.replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,"");t=t.replace(/&nbsp;/gi," ");t=t.replace(/ <\//gi,"</");while(t.indexOf("  ")!==-1){var c=t.split("  ");t=c.join(" ")}t=t.replace(/^\s*|\s*$/g,"");t=t.replace(/<[^>]*>/g,function(k){k=k.replace(/ ([^=]+)="[^"]*"/g,function(m,l){if(["alt","href","src","title"].indexOf(l)!==-1){return m}return""});return k});t=t.replace(/<\?xml[^>]*>/g,"");t=t.replace(/<[^ >]+:[^>]*>/g,"");t=t.replace(/<\/[^ >]+:[^>]*>/g,"");t=t.replace(/<(div|span|style|meta|link){1}.*?>/gi,"");i=j+t+r;return i}g.extend(true,g.trumbowyg,{plugins:{cleanPaste:{init:function(a){a.pasteHandlers.push(function(){try{var c=a.$ed.html();setTimeout(function(){var d=a.$ed.html();d=f(c,d);a.$ed.html(d)},0)}catch(b){}})}}}})})(jQuery);