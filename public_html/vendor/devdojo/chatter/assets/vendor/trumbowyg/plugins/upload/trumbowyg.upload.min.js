(function(c){var a={serverPath:"./src/plugins/upload/trumbowyg.upload.php",fileFieldName:"fileToUpload",data:[],headers:{},xhrFields:{},urlPropertyName:"file",statusPropertyName:"success",success:undefined,error:undefined};function b(f,e){var h=e.shift(),g=e;if(f!==null){if(g.length===0){return f[h]}if(typeof f==="object"){return b(f[h],g)}}return f}d();c.extend(true,c.trumbowyg,{langs:{en:{upload:"Upload",file:"File",uploadError:"Error"},sk:{upload:"Nahrať",file:"Súbor",uploadError:"Chyba"},fr:{upload:"Envoi",file:"Fichier",uploadError:"Erreur"},cs:{upload:"Nahrát obrázek",file:"Soubor",uploadError:"Chyba"},zh_cn:{upload:"上传",file:"文件",uploadError:"错误"},ru:{upload:"Загрузка",file:"Файл",uploadError:"Ошибка"}},plugins:{upload:{init:function(e){e.o.plugins.upload=c.extend(true,{},a,e.o.plugins.upload||{});var f={fn:function(){e.saveRange();var h,i=e.o.prefix;var g=e.openModalInsert(e.lang.upload,{file:{type:"file",required:true,attributes:{accept:"image/*"}},alt:{label:"description",value:e.getRangeText()}},function(j){var k=new FormData();k.append(e.o.plugins.upload.fileFieldName,h);e.o.plugins.upload.data.map(function(l){k.append(l.name,l.value)});if(c("."+i+"progress",g).length===0){c("."+i+"modal-title",g).after(c("<div/>",{"class":i+"progress"}).append(c("<div/>",{"class":i+"progress-bar"})))}c.ajax({url:e.o.plugins.upload.serverPath,headers:e.o.plugins.upload.headers,xhrFields:e.o.plugins.upload.xhrFields,type:"POST",data:k,cache:false,dataType:"json",processData:false,contentType:false,progressUpload:function(l){c("."+i+"progress-bar").stop().animate({width:Math.round(l.loaded*100/l.total)+"%"},200)},success:function(m){if(e.o.plugins.upload.success){e.o.plugins.upload.success(m,e,g,j)}else{if(!!b(m,e.o.plugins.upload.statusPropertyName.split("."))){var l=b(m,e.o.plugins.upload.urlPropertyName.split("."));e.execCmd("insertImage",l);c('img[src="'+l+'"]:not([alt])',e.$box).attr("alt",j.alt);setTimeout(function(){e.closeModal()},250);e.$c.trigger("tbwuploadsuccess",[e,m,l])}else{e.addErrorOnModalField(c("input[type=file]",g),e.lang[m.message]);e.$c.trigger("tbwuploaderror",[e,m])}}},error:e.o.plugins.upload.error||function(){e.addErrorOnModalField(c("input[type=file]",g),e.lang.uploadError);e.$c.trigger("tbwuploaderror",[e])}})});c("input[type=file]").on("change",function(k){try{h=k.target.files[0]}catch(j){h=k.target.value}})}};e.addBtnDef("upload",f)}}}});function d(){if(!c.trumbowyg&&!c.trumbowyg.addedXhrProgressEvent){var e=c.ajaxSettings.xhr;c.ajaxSetup({xhr:function(){var g=e(),f=this;if(g&&typeof g.upload==="object"&&f.progressUpload!==undefined){g.upload.addEventListener("progress",function(h){f.progressUpload(h)},false)}return g}});c.trumbowyg.addedXhrProgressEvent=true}}})(jQuery);