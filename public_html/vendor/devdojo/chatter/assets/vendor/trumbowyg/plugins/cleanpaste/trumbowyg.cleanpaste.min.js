(function(d){function b(g){var e="";for(var f=g.length-1;f>=0;f-=1){e+=g.charAt(f)}return e}function c(f){var e=f;e=e.replace(/<[^> ]*/g,function(g){return g.toLowerCase()});e=e.replace(/<[^>]*>/g,function(g){g=g.replace(/ [^=]+=/g,function(h){return h.toLowerCase()});return g});e=e.replace(/<[^>]*>/g,function(g){g=g.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return g});return e}function a(o,l){var k="";var g="";var p;var f;var e;for(p=0;l.charAt(p)===o.charAt(p);p+=1){k+=l.charAt(p)}for(var m=p;m>=0;m-=1){if(o.charAt(m)==="<"){p=m;k=o.substring(0,p);break}else{if(o.charAt(m)===">"){break}}}l=b(l);o=b(o);for(f=0;l.charAt(f)===o.charAt(f);f+=1){g+=l.charAt(f)}for(var h=f;h>=0;h-=1){if(o.charAt(h)===">"){f=h;g=o.substring(0,f);break}else{if(o.charAt(h)==="<"){break}}}g=b(g);if(p===(l.length-f)){return false}l=b(l);e=l.substring(p,l.length-f);e=c(e);e=e.replace(/<b(\s+|>)/g,"<strong$1");e=e.replace(/<\/b(\s+|>)/g,"</strong$1");e=e.replace(/<i(\s+|>)/g,"<em$1");e=e.replace(/<\/i(\s+|>)/g,"</em$1");e=e.replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,"");e=e.replace(/&nbsp;/gi," ");e=e.replace(/ <\//gi,"</");while(e.indexOf("  ")!==-1){var n=e.split("  ");e=n.join(" ")}e=e.replace(/^\s*|\s*$/g,"");e=e.replace(/<[^>]*>/g,function(i){i=i.replace(/ ([^=]+)="[^"]*"/g,function(q,j){if(["alt","href","src","title"].indexOf(j)!==-1){return q}return""});return i});e=e.replace(/<\?xml[^>]*>/g,"");e=e.replace(/<[^ >]+:[^>]*>/g,"");e=e.replace(/<\/[^ >]+:[^>]*>/g,"");e=e.replace(/<(div|span|style|meta|link){1}.*?>/gi,"");l=k+e+g;return l}d.extend(true,d.trumbowyg,{plugins:{cleanPaste:{init:function(e){e.pasteHandlers.push(function(){try{var f=e.$ed.html();setTimeout(function(){var h=e.$ed.html();h=a(f,h);e.$ed.html(h)},0)}catch(g){}})}}}})})(jQuery);