(function(g){var h=g.ephox=g.ephox||{};var i=h.bolt=h.bolt||{};var f=function(a,b){return b.apply(null,a)};var j=i.kernel=i.kernel||{};j.api=j.api||{};j.async=j.api||{};j.fp=j.fp||{};j.modulator=j.modulator||{};j.module=j.module||{};j.fp.array=f([],function(){var o=function(l,m){if(l.length!==m.length){return false}for(var k=0;k<l.length;++k){if(l[k]!==m[k]){return false}}return true};var c=function(n,k){var l=k||function(t){return t===true};for(var m=0;m<n.length;++m){if(l(n[m])!==true){return false}}return true};var q=function(n,k){var l=[];for(var m=0;m<n.length;++m){l.push(k(n[m],m))}return l};var r=function(m){var k=[];for(var l=0;l<m.length;++l){k=k.concat(m[l])}return k};var a=function(l,k){return r(q(l,k))};var p=function(n,k){var l=[];for(var m=0;m<n.length;++m){if(k(n[m])){l.push(n[m])}}return l};var b=q;var e=function(k,l){return !c(k,function(m){return m!==l})};var d=function(l,m){for(var k=0;k<l.length;++k){if(l[k]===m){return k}}return -1};return{equals:o,forall:c,map:q,flatten:r,flatmap:a,filter:p,each:b,contains:e,indexof:d}});j.fp.object=f([],function(){var b=function(e,n){var o={};for(var p in e){if(e.hasOwnProperty(p)){o[p]=n(p,e[p])}}return o};var c=b;var a=function(e,l){c(l,function(k,n){e[k]=n})};var d=function(e){var l=[];c(e,function(k){l.push(k)});return l};return{each:c,keys:d,map:b,merge:a}});j.fp.functions=f([],function(){var b=function(e){var d=Array.prototype.slice;var l=d.call(arguments,1);return function(){var k=l.concat(d.call(arguments,0));return e.apply(null,k)}};var a=function(d){return function(){var e=Array.prototype.slice;return !d.apply(null,e.call(arguments,0))}};var c=function(e){var d=Array.prototype.slice;return e.apply(null,d.call(arguments,0))};return{curry:b,not:a,apply:c}});j.async.map=f([j.fp.array],function(b){var a=function(c,d,o){var e=c.length;var n=0;var p=[];b.each(c,function(l,k){d(l,function(m){++n;p[k]=m;if(n===e){o(p)}})})};return{amap:a}});j.async.piggybacker=f([j.fp.array,j.fp.functions],function(c,a){var b=function(){var l={};var e=function(n){var k=l[n];delete l[n];c.each(k,a.apply)};var d=function(o,p,k){if(l[o]===undefined){l[o]=[k];p(a.curry(e,o))}else{l[o].push(k)}};return{piggyback:d}};return{create:b}});j.modulator.globalator=f([],function(){var a=function(){var b=function(r,p){var s=r.split(".");var t=p;for(var q=0;q<s.length&&t!==undefined;++q){t=t[s[q]]}return t};var c=Function("return this")();var d=function(l){return l.indexOf("global!")===0};var e=function(s,t,q){var r=s.substring("global!".length);var p=function(l,k){var m=b(r,c);if(m!==undefined){t(s,[],function(){return m});l()}else{k("Modulator error: could not resolve global ["+r+"]")}};return{url:s,load:p,serial:true}};return{can:d,get:e}};return{create:a}});j.modulator.bolt=f([j.fp.functions],function(a){var b=function(r,e,d,t,s,p){var c=function(k){return k===d||k.indexOf(d+".")===0||k.indexOf(d+"/")===0};var q=function(k){var m=p!==undefined&&p.absolute===true?t:e(t);var l=p!==undefined&&p.fresh===true?"?cachebuster="+new Date().getTime():"";var o=m+"/"+s(k)+".js"+l;var n=a.curry(r.load,o);return{url:o,load:n,serial:false}};return{can:c,get:q}};return{create:b}});j.module.stratifier=f([j.fp.array],function(a){var b=function(c){var d=a.filter(c,function(e){return !e.serial});return d.length>0?d:c.slice(0,1)};return{stratify:b}});j.module.analyser=f([j.fp.array],function(a){var b=function(d,o){var n=a.indexof(d,o);var e=d.slice(n);return e.concat([o])};var c=function(e,z){var x={};var B=[];var v=[];var y;var A=function(k){a.each(z[k],w)};var d=function(k){if(z[k]){A(k)}else{v.push(k)}};var t=function(k){B.push(k);d(k);B.pop()};var u=function(k){if(a.contains(B,k)){y=b(B,k)}else{t(k)}};var w=function(k){if(!x[k]){u(k);x[k]=true}};a.each(e,w);return y?{cycle:y}:{load:v}};return{analyse:c}});j.module.fetcher=f([j.fp.array,j.fp.functions,j.async.map,j.async.piggybacker,j.module.stratifier],function(l,c,b,a,e){var d=function(C,z,w,x,y,E){var F=a.create();var k=function(n,o){var m=l.filter(o,c.not(z));if(m.length>0){w("Fetcher error: modules were not defined: "+m.join(", "))}else{n()}};var A=function(n,m){var o=c.curry(m,n.id);var p=function(q){n.load(q,w)};F.piggyback(n.url,p,o)};var D=function(o,n){var m=c.curry(k,n);var p=e.stratify(o);b.amap(p,A,m)};var B=function(m,n){C.regulate(m,x,y,E,function(o){D(o,n)},w)};return{fetch:B}};return{create:d}});j.module.loader=f([j.module.analyser],function(b){var a=function(e,r,c,d,o,p){var q=b.analyse(e,r);if(q.cycle){p("Dependency error: a circular module dependency exists from "+q.cycle.join(" ~> "))}else{if(q.load.length===0){o()}else{c.fetch(q.load,d)}}};return{load:a}});j.module.manager=f([j.fp.array,j.fp.object,j.module.loader,j.module.fetcher],function(d,a,e,b){var c=function(D,v){var x={};var y={};var w=function(k,l,m){if(k===undefined){v("Define error: module id can not be undefined")}else{if(x[k]!==undefined){v("Define error: module '"+k+"' is already defined")}else{x[k]={id:k,dependencies:l,definition:m}}}};var z=function(l,k){var n=function(){var o=d.map(l,u);k.apply(null,o)};var m=function(){var o=a.map(x,function(p,q){return q.dependencies});e.load(l,o,B,m,n,v)};m()};var u=function(k){if(y[k]!==undefined){return y[k]}if(x[k]===undefined){throw"module '"+k+"' is not defined"}var l=C(k);if(l===undefined){throw"module '"+k+"' returned undefined from definition function"}y[k]=l;return l};var C=function(k){var l=x[k];var m=d.map(l.dependencies,u);return l.definition.apply(null,m)};var A=function(k){return x[k]!==undefined};var B=b.create(D,A,v,w,z,u);return{define:w,require:z,demand:u}};return{create:c}});j.api.sources=f([j.fp.array,j.fp.object,j.modulator.globalator],function(d,a,b){var c=function(C,A){var y={global:{instance:b}};a.each(C,function(l,k){y[l]={instance:k}});d.each(A.types,function(k){y[k.type]={id:k.modulator}});var w=A.sources.slice(0);var B=[b.create()];var F=function(k){if(y[k]===undefined){throw"Unknown modulator type ["+k+"]."}};var e=function(k){F(k);return y[k].instance!==undefined};var x=function(k){F(k);return y[k].id};var z=function(k){F(k);return y[k].instance};var D=function(k,l){F(k);y[k].instance=l};var v=function(k){for(var l=0;l<B.length;++l){if(B[l].can(k)){return{found:B[l]}}}return{notfound:true}};var E=function(){var k=[];d.each(w,function(l){if(e(l.type)){var m=z(l.type);var n=m.create.apply(null,l.args);B.push(n)}else{k.push(l)}});w=k};return{isResolved:e,idOf:x,instanceOf:z,register:D,find:v,crank:E}};return{create:c}});j.api.regulator=f([j.fp.array,j.fp.functions],function(c,a){var b=function(p){var d=function(m,k,n,w,x,y){p.crank();var l=c.map(m,o);var z=c.filter(l,a.not(p.isResolved));if(z.length===0){e(m,k,n,w,x,y)}else{q(z,m,k,n,w,x,y)}};var e=function(k,D,F,A,n,C){var l=[];for(var E=0;E<k.length;++E){var G=k[E];var m=p.find(G);if(m.notfound){C("Could not find source for module ["+G+"]");return}var B=m.found.get(G,D,F,A);l[E]=r(G,B)}n(l)};var r=function(k,l){return{id:k,url:l.url,load:l.load,serial:l.serial}};var q=function(m,l,k,w,x,y,z){var n=c.map(m,p.idOf);w(n,function(){var s=arguments;c.each(m,function(u,t){p.register(u,s[t])});d(l,k,w,x,y,z)})};var o=function(k){var l=k.indexOf("!");return l===-1?"bolt":k.substring(0,l)};return{regulate:d}};return{create:b}});j.api.config=f([j.module.manager,j.api.regulator,j.api.sources],function(b,a,c){var d=function(s,t,r){var p=c.create(t,s);var e=a.create(p);var q=b.create(e,r);return{define:q.define,require:q.require,demand:q.demand}};return{configure:d}})})(Function("return this")());(function(scope){var ephox=scope.ephox=scope.ephox||{};var bolt=ephox.bolt=ephox.bolt||{};var def=function(deps,factory){return factory.apply(null,deps)};var loader=bolt.loader=bolt.loader||{};loader.executor=loader.executor||{};loader.api=loader.api||{};loader.transporter=loader.transporter||{};loader.tag=loader.tag||{};loader.tag.script=def([],function(){var guard=function(callback){return function(evt){if(evt.srcElement.readyState==="loaded"||evt.srcElement.readyState==="complete"){callback()}}};var ie=function(el){return el.attachEvent&&!window.opera};var onload=function(el,callback){if(ie(el)){el.attachEvent("onreadystatechange",guard(callback))}else{el.addEventListener("load",callback,false)}};var createtag=function(callback){var el=document.createElement("script");el.type="text/javascript";onload(el,callback);return el};var insert=function(decorator,callback){var el=createtag(callback);decorator(el);var head=document.getElementsByTagName("head")[0];head.appendChild(el)};return{insert:insert}});loader.transporter.commonjs=def([],function(){var read=function(url,success,error){var fs=require("fs");fs.exists(url,function(exists){if(exists){fs.readFile(url,"UTF-8",function(err,data){if(err){error("Error reading file ["+url+"], error ["+err+"]")}else{success(data)}})}else{error("File does not exist ["+url+"]")}})};return{read:read}});loader.transporter.xhr=def([],function(){var requestObject=function(){var factories=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return fallback(factories)};var fallback=function(items){for(var i=0;i<items.length;++i){try{return items[i]()}catch(e){}}};var handler=function(req,url,success,error){return function(){if(req.readyState===4){done(req,url,success,error)}}};var done=function(req,url,success,error){if(req.status===200||req.status===304){success(req.responseText)}else{error("Transport error: "+req.status+" "+req.statusText+' for resource: "'+url+'"')}};var getUrl=function(req,url,success,error){req.open("GET",url,true);req.onreadystatechange=handler(req,url,success,error);req.send()};var request=function(url,success,error){var req=requestObject();if(req){getUrl(req,url,success,error)}else{error("Transport error: browser does not support XMLHttpRequest.")}};return{request:request}});loader.executor.evaller=def([],function(){var execute=function(data,onsuccess,onfailure){try{eval(data)}catch(e){onfailure(e);return}onsuccess()};return{execute:execute}});loader.executor.injector=def([loader.tag.script],function(script){var execute=function(data,onsuccess,onfailure){var inject=function(tag){tag.text=data};var noop=function(){};script.insert(inject,noop);onsuccess()};return{execute:execute}});loader.api.commonjsevaller=def([loader.transporter.commonjs,loader.executor.evaller],function(commonjs,evaller){var load=function(url,onsuccess,onfailure){var inject=function(data){evaller.execute(data,onsuccess,onfailure)};commonjs.read(url,inject,onfailure)};return{load:load}});loader.api.scripttag=def([loader.tag.script],function(script){var load=function(url,onsuccess,onfailure){var sourcer=function(tag){tag.src=url};script.insert(sourcer,onsuccess)};return{load:load}});loader.api.xhrevaller=def([loader.transporter.xhr,loader.executor.evaller],function(xhr,evaller){var load=function(url,onsuccess,onfailure){var inject=function(data){evaller.execute(data,onsuccess,onfailure)};xhr.request(url,inject,onfailure)};return{load:load}});loader.api.xhrinjector=def([loader.transporter.xhr,loader.executor.injector],function(xhr,injector){var load=function(url,onsuccess,onfailure){var inject=function(data){injector.execute(data,onsuccess)};xhr.request(url,inject,onfailure)};return{load:load}})})(Function("return this")());(function(scope){var ephox=scope.ephox=scope.ephox||{};var bolt=ephox.bolt=ephox.bolt||{};var def=function(deps,factory){return factory.apply(null,deps)};var module=bolt.module=bolt.module||{};module.bootstrap=module.bootstrap||{};module.config=module.config||{};module.error=module.error||{};module.modulator=module.modulator||{};module.reader=module.reader||{};module.runtime=module.runtime||{};module.util=module.util||{};module.error.error=def([],function(){var die=function(msg){throw msg||new Error("unknown error")};return{die:die}});module.config.mapper=def([],function(){var flat=function(id){return id};var hierarchical=function(id){return id.replace(/\./g,"/")};var constant=function(name){return function(){return name}};return{flat:flat,hierarchical:hierarchical,constant:constant}});module.api=def([module.runtime],function(runtime){var delegate=function(method){return function(){return runtime[method].apply(null,arguments)}};return{define:delegate("define"),require:delegate("require"),demand:delegate("demand"),main:delegate("main"),load:delegate("load"),loadscript:delegate("loadscript")}});module.util.path=def([],function(){var dirname=function(file){var normalized=file.replace(/\\/g,"/");var end=normalized.lastIndexOf("/");return normalized.substring(0,end)};var basename=function(file){var normalized=file.replace(/\\/g,"/");var end=normalized.lastIndexOf("/");return normalized.substring(end+1)};return{basename:basename,dirname:dirname}});module.util.locator=def([],function(){var browser=function(){var scripts=document.getElementsByTagName("script");return scripts[scripts.length-1].src};var runtime=module.runtime.locate;var locate=function(){var f=runtime||browser;return f()};return{locate:locate}});module.util.pather=def([module.util.path],function(path){var create=function(relativeto){var base=path.dirname(relativeto);return function(path){return base+"/"+path}};return{create:create}});module.modulator.modulators=def([ephox.bolt.kernel.fp.functions,ephox.bolt.kernel.modulator.bolt,ephox.bolt.loader.api.commonjsevaller,ephox.bolt.loader.api.scripttag,ephox.bolt.loader.api.xhrevaller,ephox.bolt.loader.api.xhrinjector],function(fn,bolt,commonjsevaller,scripttag,xhrevaller,xhrinjector){var wrap=function(modulator,loader){var create=fn.curry(modulator.create,loader);return{create:create}};return{boltcommonjs:wrap(bolt,commonjsevaller),boltscripttag:wrap(bolt,scripttag),boltxhreval:wrap(bolt,xhrevaller),boltxhrinjector:wrap(bolt,xhrinjector)}});module.config.builtins=def([ephox.bolt.module.modulator.modulators.boltscripttag,ephox.bolt.module.modulator.modulators.boltcommonjs],function(boltscripttag,boltcommonjs){return{browser:{bolt:boltscripttag,amd:boltscripttag},commonjs:{bolt:boltcommonjs,amd:boltcommonjs}}});module.config.specs=def([module.util.pather],function(pather){var type=function(type,implementation){return{type:type,implementation:implementation,modulator:implementation+".Modulator",compiler:implementation+".Compiler"}};var source=function(relativeto){return function(type){return{type:type,relativeto:relativeto,args:[pather.create(relativeto)].concat(Array.prototype.slice.call(arguments,1))}}};return{type:type,source:source}});module.reader.bouncing=def([ephox.bolt.kernel.fp.array,module.error.error,module.config.specs],function(ar,error,specs){var bounce=function(done,read,acc){var next=acc.configs.shift();read(next.relativeto,next.config,done,acc)};var tick=function(file,cfg,done,read,acc){var munged=ar.map(cfg.configs||[],function(config){return{relativeto:file,config:config}});var accumulated={sources:acc.sources.concat(cfg.sources||[]),types:acc.types.concat(cfg.types||[]),configs:munged.concat(acc.configs)};if(accumulated.configs.length>0){bounce(done,read,accumulated)}else{done({sources:accumulated.sources,types:accumulated.types})}};var evaluate=function(file,payload,done,read,acc){var result={};var mapper=module.config.mapper;var type=specs.type;var source=specs.source(file);var configure=function(configuration){result=configuration};try{eval(payload)}catch(e){throw"Could not load configuration ["+file+"], with: "+e}tick(file,result,done,read,acc)};return{evaluate:evaluate}});module.reader.browser=def([module.error.error,module.reader.bouncing,module.util.path,ephox.bolt.loader.transporter.xhr],function(error,bouncing,path,xhr){var read=function(relativeto,file,done,acc){var accumulated=acc||{sources:[],types:[],configs:[]};var base=path.dirname(relativeto);var absolute=base+"/"+file;xhr.request(absolute,function(payload){bouncing.evaluate(absolute,payload,done,read,accumulated)},error.die)};return{read:read}});module.reader.node=def([module.reader.bouncing],function(bouncing,path,fs){var read=function(relativeto,file,done,acc){var fs=require("fs");var path=require("path");var accumulated=acc||{sources:[],types:[],configs:[]};var base=path.dirname(relativeto);var absolute=path.resolve(base,file);var payload=fs.readFileSync(absolute,"UTF-8");bouncing.evaluate(absolute,payload,done,read,accumulated)};return{read:read}});module.reader.direct=def([],function(){var create=function(configuration){return function(done){done({sources:configuration.sources||[],types:configuration.types||[],configs:configuration.configs||[]})}};return{create:create}});module.bootstrap.configloader=def([module.util.locator,module.reader.browser],function(locator,browser){var create=function(file){var script=locator.locate();return function(done){browser.read(script,file,done)}};return{create:create}});module.bootstrap.deferred=def([ephox.bolt.kernel.fp.array],function(ar){var deferred=[];var require=function(ids,fn){var r=function(real){real(ids,fn)};deferred.push(r)};var configured=function(require){ar.each(deferred,function(action){action(require)});deferred=[]};return{require:require,configured:configured}});module.bootstrap.main=def([ephox.bolt.kernel.api.config,module.bootstrap.deferred,module.runtime],function(config,deferred,runtime){var main=function(id,args,configids,callback){runtime.require(configids||[],function(){callback&&callback.apply(null,arguments);runtime.require([id],function(module){module.apply(null,args||[])})})};return{main:main}});module.bootstrap.install=def([ephox.bolt.kernel.api.config,module.bootstrap.deferred,module.bootstrap.main,module.runtime,module.error.error],function(config,deferred,main,runtime,error){var notready=function(){throw"bolt not initialised, can not call define or demand, did you mean to use require or main?"};var install=function(reader,builtins,load,loadscript){runtime.define=notready;runtime.demand=notready;runtime.require=deferred.require;runtime.main=main.main;runtime.load=load;runtime.loadscript=loadscript;reader(function(configuration){var bolt=config.configure(configuration,builtins,error.die);runtime.define=bolt.define;runtime.require=bolt.require;runtime.demand=bolt.demand;deferred.configured(runtime.require)})};return{install:install}})})(Function("return this")());(function(o){var m=ephox.bolt.kernel.fp.object;var p=ephox.bolt.module.api;var k=ephox.bolt.module.config.builtins.browser;var n=ephox.bolt.module.bootstrap.install;var j=ephox.bolt.module.bootstrap.configloader.create("prod.js");var l=ephox.bolt.loader.transporter.xhr.request;var i=ephox.bolt.loader.api.scripttag.load;n.install(j,k,l,i);m.merge(o,p)})(Function("return this;")());