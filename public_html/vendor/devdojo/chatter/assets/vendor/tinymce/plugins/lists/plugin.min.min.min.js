tinymce.PluginManager.add("lists",function(a){function b(j){return a.$.contains(a.getBody(),j)}function c(j){return j&&"BR"==j.nodeName}function d(j){return j&&/^(OL|UL|DL)$/.test(j.nodeName)&&b(j)}function e(j){return j.parentNode.firstChild==j}function f(j){return j.parentNode.lastChild==j}function g(j){return j&&!!a.schema.getTextBlockElements()[j.nodeName]}function h(j){return j===a.getBody()}var i=this;a.on("init",function(){function j(F,G){var E=q.isEmpty(F);return G&&q.select("span[data-mce-type=bookmark]").length>0?!1:E}function k(F){function G(J){var K,H,I;H=F[J?"startContainer":"endContainer"],I=F[J?"startOffset":"endOffset"],1==H.nodeType&&(K=q.create("span",{"data-mce-type":"bookmark"}),H.hasChildNodes()?(I=Math.min(I,H.childNodes.length-1),J?H.insertBefore(K,H.childNodes[I]):q.insertAfter(K,H.childNodes[I])):H.appendChild(K),H=K,I=0),E[J?"startContainer":"endContainer"]=H,E[J?"startOffset":"endOffset"]=I}var E={};return G(!0),F.collapsed||G(),E}function l(F){function G(J){function K(O){for(var M=O.parentNode.firstChild,N=0;M;){if(M==O){return N}1==M.nodeType&&"bookmark"==M.getAttribute("data-mce-type")||N++,M=M.nextSibling}return -1}var L,H,I;L=I=F[J?"startContainer":"endContainer"],H=F[J?"startOffset":"endOffset"],L&&(1==L.nodeType&&(H=K(L),L=L.parentNode,q.remove(I)),F[J?"startContainer":"endContainer"]=L,F[J?"startOffset":"endOffset"]=H)}G(!0),G();var E=q.createRng();E.setStart(F.startContainer,F.startOffset),F.endContainer&&E.setEnd(F.endContainer,F.endOffset),s.setRng(E)}function m(J,K){var L,E,F,G=q.createFragment(),H=a.schema.getBlockElements();if(a.settings.forced_root_block&&(K=K||a.settings.forced_root_block),K&&(E=q.create(K),E.tagName===a.settings.forced_root_block&&q.setAttribs(E,a.settings.forced_root_block_attrs),G.appendChild(E)),J){for(;L=J.firstChild;){var I=L.nodeName;F||"SPAN"==I&&"bookmark"==L.getAttribute("data-mce-type")||(F=!0),H[I]?(G.appendChild(L),E=null):K?(E||(E=q.create(K),G.appendChild(E)),E.appendChild(L)):G.appendChild(L)}}return a.settings.forced_root_block?F||tinymce.Env.ie&&!(tinymce.Env.ie>10)||E.appendChild(q.create("br",{"data-mce-bogus":"1"})):G.appendChild(q.create("br")),G}function n(){return tinymce.grep(s.getSelectedBlocks(),function(E){return/^(LI|DT|DD)$/.test(E.nodeName)})}function o(I,J,K){function L(M){tinymce.each(G,function(N){M.parentNode.insertBefore(N,J.parentNode)}),q.remove(M)}var E,F,G,H;for(G=q.select('span[data-mce-type="bookmark"]',I),K=K||m(J),E=q.createRng(),E.setStartAfter(J),E.setEndAfter(I),F=E.extractContents(),H=F.firstChild;H;H=H.firstChild){if("LI"==H.nodeName&&q.isEmpty(H)){q.remove(H);break}}q.isEmpty(F)||q.insertAfter(F,I),q.insertAfter(K,I),j(J.parentNode)&&L(J.parentNode),q.remove(J),j(I)&&q.remove(I)}function p(F){var G,E;if(G=F.nextSibling,G&&d(G)&&G.nodeName==F.nodeName&&u(F,G)){for(;E=G.firstChild;){F.appendChild(E)}q.remove(G)}if(G=F.previousSibling,G&&d(G)&&G.nodeName==F.nodeName&&u(F,G)){for(;E=G.firstChild;){F.insertBefore(E,F.firstChild)}q.remove(G)}}function r(E){tinymce.each(tinymce.grep(q.select("ol,ul",E)),function(G){var H,F=G.parentNode;"LI"==F.nodeName&&F.firstChild==G&&(H=F.previousSibling,H&&"LI"==H.nodeName&&(H.appendChild(G),j(F)&&q.remove(F))),d(F)&&(H=F.previousSibling,H&&"LI"==H.nodeName&&H.appendChild(G))})}function t(H){function I(J){j(J)&&q.remove(J)}var E,F=H.parentNode,G=F.parentNode;return h(F)?!0:"DD"==H.nodeName?(q.rename(H,"DT"),!0):e(H)&&f(H)?("LI"==G.nodeName?(q.insertAfter(H,G),I(G),q.remove(F)):d(G)?q.remove(F,!0):(G.insertBefore(m(H),F),q.remove(F)),!0):e(H)?("LI"==G.nodeName?(q.insertAfter(H,G),H.appendChild(F),I(G)):d(G)?G.insertBefore(H,F):(G.insertBefore(m(H),F),q.remove(H)),!0):f(H)?("LI"==G.nodeName?q.insertAfter(H,G):d(G)?q.insertAfter(H,F):(q.insertAfter(m(H),F),q.remove(H)),!0):("LI"==G.nodeName?(F=G,E=m(H,"LI")):E=d(G)?m(H,"LI"):m(H),o(F,H,E),r(F.parentNode),!0)}function v(H){function I(J,K){var L;if(d(J)){for(;L=H.lastChild.firstChild;){K.appendChild(L)}q.remove(J)}}var E,F,G;return"DT"==H.nodeName?(q.rename(H,"DD"),!0):(E=H.previousSibling,E&&d(E)?(E.appendChild(H),!0):E&&"LI"==E.nodeName&&d(E.lastChild)?(E.lastChild.appendChild(H),I(H.lastChild,E.lastChild),!0):(E=H.nextSibling,E&&d(E)?(E.insertBefore(H,E.firstChild),!0):(E=H.previousSibling,E&&"LI"==E.nodeName?(F=q.create(H.parentNode.nodeName),G=q.getStyle(H.parentNode,"listStyleType"),G&&q.setStyle(F,"listStyleType",G),E.appendChild(F),F.appendChild(H),I(H.lastChild,F),!0):!1)))}function x(){var G=n();if(G.length){for(var E=k(s.getRng(!0)),F=0;F<G.length&&(v(G[F])||0!==F);F++){}return l(E),a.nodeChanged(),!0}}function y(){var J=n();if(J.length){var E,F,G=k(s.getRng(!0)),H=a.getBody();for(E=J.length;E--;){for(var I=J[E].parentNode;I&&I!=H;){for(F=J.length;F--;){if(J[F]===I){J.splice(E,1);break}}I=I.parentNode}}for(E=0;E<J.length&&(t(J[E])||0!==E);E++){}return l(G),a.nodeChanged(),!0}}function z(J,E){function F(){function T(R){var V,Q;for(V=H[R?"startContainer":"endContainer"],Q=H[R?"startOffset":"endOffset"],1==V.nodeType&&(V=V.childNodes[Math.min(Q,V.childNodes.length-1)]||V);V.parentNode!=N;){if(g(V)){return V}if(/^(TD|TH)$/.test(V.parentNode.nodeName)){return V}V=V.parentNode}return V}for(var L,M=[],N=a.getBody(),P=T(!0),S=T(),K=[],O=P;O&&(K.push(O),O!=S);O=O.nextSibling){}return tinymce.each(K,function(Q){if(g(Q)){return M.push(Q),void (L=null)}if(q.isBlock(Q)||c(Q)){return c(Q)&&q.remove(Q),void (L=null)}var R=Q.nextSibling;return tinymce.dom.BookmarkManager.isBookmarkNode(Q)&&(g(R)||!R&&Q.parentNode==N)?void (L=null):(L||(L=q.create("p"),Q.parentNode.insertBefore(L,Q),M.push(L)),void L.appendChild(Q))}),M}var G,H=s.getRng(!0),I="LI";"false"!==q.getContentEditable(s.getNode())&&(J=J.toUpperCase(),"DL"==J&&(I="DT"),G=k(H),tinymce.each(F(),function(N){var M,K,L=function(P){var R=q.getStyle(P,"list-style-type"),O=E?E["list-style-type"]:"";return O=null===O?"":O,R===O};K=N.previousSibling,K&&d(K)&&K.nodeName==J&&L(K)?(M=K,N=q.rename(N,I),K.appendChild(N)):(M=q.create(J),N.parentNode.insertBefore(M,N),M.appendChild(N),N=q.rename(N,I)),w(M,E),p(M)}),l(G))}function A(){var F=k(s.getRng(!0)),E=a.getBody();tinymce.each(n(),function(H){var I,G;if(!h(H.parentNode)){if(j(H)){return void t(H)}for(I=H;I&&I!=E;I=I.parentNode){d(I)&&(G=I)}o(G,H)}}),l(F)}function B(G,H){var E=q.getParent(s.getStart(),"OL,UL,DL");if(!h(E)){if(E){if(E.nodeName==G){A(G)}else{var F=k(s.getRng(!0));w(E,H),p(q.rename(E,G)),l(F)}}else{z(G,H)}}}function C(E){return function(){var F=q.getParent(a.selection.getStart(),"UL,OL,DL");return F&&F.nodeName==E}}function D(E){return c(E)?!(!q.isBlock(E.nextSibling)||c(E.previousSibling)):!1}var q=a.dom,s=a.selection,u=function(H,E){var F=a.dom.getStyle(H,"list-style-type",!0),G=a.dom.getStyle(E,"list-style-type",!0);return F===G},w=function(E,F){q.setStyle(E,"list-style-type",F?F["list-style-type"]:null)};i.backspaceDelete=function(E){function G(M,N){var O,P,S=M.startContainer,T=M.startOffset;if(3==S.nodeType&&(N?T<S.data.length:T>0)){return S}for(O=a.schema.getNonEmptyElements(),1==S.nodeType&&(S=tinymce.dom.RangeUtils.getNode(S,T)),P=new tinymce.dom.TreeWalker(S,a.getBody()),N&&D(S)&&P.next();S=P[N?"next":"prev2"]();){if("LI"==S.nodeName&&!S.hasChildNodes()){return S}if(O[S.nodeName]){return S}if(3==S.nodeType&&S.data.length>0){return S}}}function H(M,N){var O,P,R=M.parentNode;if(b(M)&&b(N)){if(d(N.lastChild)&&(P=N.lastChild),R==N.lastChild&&c(R.previousSibling)&&q.remove(R.previousSibling),O=N.lastChild,O&&c(O)&&M.hasChildNodes()&&q.remove(O),j(N,!0)&&q.$(N).empty(),!j(M,!0)){for(;O=M.firstChild;){N.appendChild(O)}}P&&N.appendChild(P),q.remove(M),j(R)&&!h(R)&&q.remove(R)}}if(s.isCollapsed()){var I,J,K,L=q.getParent(s.getStart(),"LI");if(L){if(I=L.parentNode,h(I)&&q.isEmpty(I)){return !0}if(J=s.getRng(!0),K=q.getParent(G(J,E),"LI"),K&&K!=L){var F=k(J);return E?H(K,L):H(L,K),l(F),!0}if(!K&&!E&&A(I.nodeName)){return !0}}}},a.on("BeforeExecCommand",function(G){var E,F=G.command.toLowerCase();return"indent"==F?x()&&(E=!0):"outdent"==F&&y()&&(E=!0),E?(a.fire("ExecCommand",{command:G.command}),G.preventDefault(),!0):void 0}),a.addCommand("InsertUnorderedList",function(E,F){B("UL",F)}),a.addCommand("InsertOrderedList",function(E,F){B("OL",F)}),a.addCommand("InsertDefinitionList",function(E,F){B("DL",F)}),a.addQueryStateHandler("InsertUnorderedList",C("UL")),a.addQueryStateHandler("InsertOrderedList",C("OL")),a.addQueryStateHandler("InsertDefinitionList",C("DL")),a.on("keydown",function(E){9!=E.keyCode||tinymce.util.VK.metaKeyPressed(E)||a.dom.getParent(a.selection.getStart(),"LI,DT,DD")&&(E.preventDefault(),E.shiftKey?y():x())})}),a.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var j=this;a.on("nodechange",function(){for(var m=a.selection.getSelectedBlocks(),n=!1,l=0,o=m.length;!n&&o>l;l++){var k=m[l].nodeName;n="LI"==k&&e(m[l])||"UL"==k||"OL"==k||"DD"==k}j.disabled(n)})}}),a.on("keydown",function(j){j.keyCode==tinymce.util.VK.BACKSPACE?i.backspaceDelete()&&j.preventDefault():j.keyCode==tinymce.util.VK.DELETE&&i.backspaceDelete(!0)&&j.preventDefault()})});