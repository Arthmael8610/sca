tinymce.PluginManager.add("visualchars",function(g){function f(B){function A(b){return'<span data-mce-bogus="1" class="mce-'+r[b]+'">'+b+"</span>"}function z(){var k,c="";for(k in r){c+=k}return new RegExp("["+c+"]","g")}function y(){var k,c="";for(k in r){c&&(c+=","),c+="span.mce-"+r[k]}return c}var x,w,v,u,t,s,r,e,d=g.getBody(),a=g.selection;if(r={"\xa0":"nbsp","\xad":"shy"},i=!i,h.state=i,g.fire("VisualChars",{state:i}),e=z(),B&&(s=a.getBookmark()),i){for(w=[],tinymce.walk(d,function(b){3==b.nodeType&&b.nodeValue&&e.test(b.nodeValue)&&w.push(b)},"childNodes"),v=0;v<w.length;v++){for(u=w[v].nodeValue,u=u.replace(e,A),t=g.dom.create("div",null,u);x=t.lastChild;){g.dom.insertAfter(x,w[v])}g.dom.remove(w[v])}}else{for(w=g.dom.select(y(),d),v=w.length-1;v>=0;v--){g.dom.remove(w[v],1)}}a.moveToBookmark(s)}function j(){var a=this;g.on("VisualChars",function(b){a.active(b.state)})}var i,h=this;g.addCommand("mceVisualChars",f),g.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j}),g.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j,selectable:!0,context:"view",prependToContext:!0}),g.on("beforegetcontent",function(b){i&&"raw"!=b.format&&!b.draft&&(i=!0,f(!1))})});