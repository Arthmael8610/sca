tinymce.PluginManager.add("textcolor",function(t){function s(a){var d;return t.dom.getParents(t.selection.getStart(),function(b){var c;(c=b.style["forecolor"==a?"color":"background-color"])&&(d=c)}),d}function r(a){var h,g,f=[];for(g=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],g=t.settings.textcolor_map||g,g=t.settings[a+"_map"]||g,h=0;h<g.length;h+=2){f.push({text:g[h+1],color:"#"+g[h]})}return f}function q(){function B(e,d){var f="transparent"==e;return'<td class="mce-grid-cell'+(f?" mce-colorbtn-trans":"")+'"><div id="'+c+"-"+a+++'" data-mce-color="'+(e?e:"")+'" role="option" tabIndex="-1" style="'+(e?"background-color: "+e:"")+'" title="'+tinymce.translate(d)+'">'+(f?"&#215;":"")+"</div></td>"}var A,z,y,x,w,v,u,j,i=this,c=i._id,a=0;for(j=i.settings.origin,A=r(j),A.push({text:tinymce.translate("No color"),color:"transparent"}),y='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',x=A.length-1,v=0;v<k[j];v++){for(y+="<tr>",w=0;w<l[j];w++){u=v*l[j]+w,u>x?y+="<td></td>":(z=A[u],y+=B(z.color,z.text))}y+="</tr>"}if(t.settings.color_picker_callback){for(y+='<tr><td colspan="'+l[j]+'" class="mce-custom-color-btn"><div id="'+c+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+c+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",y+="<tr>",w=0;w<l[j];w++){y+=B("","Custom color")}y+="</tr>"}return y+="</tbody></table>"}function p(a,d){t.undoManager.transact(function(){t.focus(),t.formatter.apply(a,{value:d}),t.nodeChanged()})}function o(a){t.undoManager.transact(function(){t.focus(),t.formatter.remove(a,{value:null},null,!0),t.nodeChanged()})}function n(v){function u(c){a.hidePanel(),a.color(c),p(a.settings.format,c)}function i(){a.hidePanel(),a.resetColor(),o(a.settings.format)}function f(d,c){d.style.background=c,d.setAttribute("data-mce-color",c)}var e,b,a=this.parent();b=a.settings.origin,tinymce.DOM.getParent(v.target,".mce-custom-color-btn")&&(a.hidePanel(),t.settings.color_picker_callback.call(t,function(g){var d,w,j,h=a.panel.getEl().getElementsByTagName("table")[0];for(d=tinymce.map(h.rows[h.rows.length-1].childNodes,function(c){return c.firstChild}),j=0;j<d.length&&(w=d[j],w.getAttribute("data-mce-color"));j++){}if(j==l[b]){for(j=0;j<l[b]-1;j++){f(d[j],d[j+1].getAttribute("data-mce-color"))}}f(w,g),u(g)},s(a.settings.format))),e=v.target.getAttribute("data-mce-color"),e?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),v.target.setAttribute("aria-selected",!0),this.lastId=v.target.id,"transparent"==e?i():u(e)):null!==e&&a.hidePanel()}function m(){var b=this;b._color?p(b.settings.format,b._color):o(b.settings.format)}var l,k;k={forecolor:t.settings.forecolor_rows||t.settings.textcolor_rows||5,backcolor:t.settings.backcolor_rows||t.settings.textcolor_rows||5},l={forecolor:t.settings.forecolor_cols||t.settings.textcolor_cols||8,backcolor:t.settings.backcolor_cols||t.settings.textcolor_cols||8},t.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:q,onclick:n},onclick:m}),t.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:q,onclick:n},onclick:m})});