tinymce.PluginManager.add("autolink",function(i){function h(b){l(b,-1,"(",!0)}function n(b){l(b,0,"",!0)}function m(b){l(b,-1,"",!1)}function l(F,E,D){function C(e,d){if(0>d&&(d=0),3==e.nodeType){var f=e.data.length;d>f&&(d=f)}return d}function B(d,c){1!=d.nodeType||d.hasChildNodes()?z.setStart(d,C(d,c)):z.setStartBefore(d)}function A(d,c){1!=d.nodeType||d.hasChildNodes()?z.setEnd(d,C(d,c)):z.setEndAfter(d)}var z,y,x,w,v,u,t,s,r,g;if("A"!=F.selection.getNode().tagName){if(z=F.selection.getRng(!0).cloneRange(),z.startOffset<5){if(s=z.endContainer.previousSibling,!s){if(!z.endContainer.firstChild||!z.endContainer.firstChild.nextSibling){return}s=z.endContainer.firstChild.nextSibling}if(r=s.length,B(s,r),A(s,r),z.endOffset<5){return}y=z.endOffset,w=s}else{if(w=z.endContainer,3!=w.nodeType&&w.firstChild){for(;3!=w.nodeType&&w.firstChild;){w=w.firstChild}3==w.nodeType&&(B(w,0),A(w,w.nodeValue.length))}y=1==z.endOffset?2:z.endOffset-1-E}x=y;do{B(w,y>=2?y-2:0),A(w,y>=1?y-1:0),y-=1,g=z.toString()}while(" "!=g&&""!==g&&160!=g.charCodeAt(0)&&y-2>=0&&g!=D);z.toString()==D||160==z.toString().charCodeAt(0)?(B(w,y),A(w,x),y+=1):0===z.startOffset?(B(w,0),A(w,x)):(B(w,y),A(w,x)),u=z.toString(),"."==u.charAt(u.length-1)&&A(w,x-1),u=z.toString(),t=u.match(j),t&&("www."==t[1]?t[1]="http://www.":/@$/.test(t[1])&&!/^mailto:/.test(t[1])&&(t[1]="mailto:"+t[1]),v=F.selection.getBookmark(),F.selection.setRng(z),F.execCommand("createlink",!1,t[1]+t[2]),F.selection.moveToBookmark(v),F.nodeChanged())}}var k,j=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;return i.settings.autolink_pattern&&(j=i.settings.autolink_pattern),i.on("keydown",function(a){return 13==a.keyCode?m(i):void 0}),tinymce.Env.ie?void i.on("focus",function(){if(!k){k=!0;try{i.execCommand("AutoUrlDetect",!1,!0)}catch(a){}}}):(i.on("keypress",function(a){return 41==a.keyCode?h(i):void 0}),void i.on("keyup",function(a){return 32==a.keyCode?n(i):void 0}))});