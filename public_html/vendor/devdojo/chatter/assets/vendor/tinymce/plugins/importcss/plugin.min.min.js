tinymce.PluginManager.add("importcss",function(j){function i(d){var c=tinymce.Env.cacheSuffix;return"string"==typeof d&&(d=d.replace("?"+c,"").replace("&"+c,"")),d}function p(a){var h=j.settings,g=h.skin!==!1?h.skin||"lightgray":!1;if(g){var f=h.skin_url;return f=f?j.documentBaseURI.toAbsolute(f):tinymce.baseURL+"/skins/"+g,a===f+"/content"+(j.inline?".inline":"")+".min.css"}return !1}function o(b){return"string"==typeof b?function(a){return -1!==a.indexOf(b)}:b instanceof RegExp?function(a){return b.test(a)}:b}function n(r,q){function h(e,t){var s,g=e.href;if(g=i(g),g&&q(g,t)&&!p(g)){k(e.imports,function(d){h(d,!0)});try{s=e.cssRules||e.rules}catch(f){}k(s,function(d){d.styleSheet?h(d.styleSheet,!0):d.selectorText&&k(d.selectorText.split(","),function(u){c.push(tinymce.trim(u))})})}}var c=[],b={};k(j.contentCSS,function(d){b[d]=!0}),q||(q=function(e,d){return d||b[e]});try{k(r.styleSheets,function(d){h(d)})}catch(a){}return c}function m(a){var t,s=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(a);if(s){var r=s[1],q=s[2].substr(1).split(".").join(" "),h=tinymce.makeMap("a,img");return s[1]?(t={title:a},j.schema.getTextBlockElements()[r]?t.block=r:j.schema.getBlockElements()[r]||h[r.toLowerCase()]?t.selector=r:t.inline=r):s[2]&&(t={inline:"span",title:a.substr(1),classes:q}),j.settings.importcss_merge_classes!==!1?t.classes=q:t.attributes={"class":q},t}}var l=this,k=tinymce.each;j.on("renderFormatsMenu",function(d){var q=j.settings,h={},g=q.importcss_selector_converter||m,f=o(q.importcss_selector_filter),e=d.control;j.settings.importcss_append||e.items().remove();var a=[];tinymce.each(q.importcss_groups,function(b){b=tinymce.extend({},b),b.filter=o(b.filter),a.push(b)}),k(n(d.doc||j.getDoc(),o(q.importcss_file_filter)),function(r){if(-1===r.indexOf(".mce-")&&!h[r]&&(!f||f(r))){var w,v=g.call(l,r);if(v){var u=v.name||tinymce.DOM.uniqueId();if(a){for(var t=0;t<a.length;t++){if(!a[t].filter||a[t].filter(r)){a[t].item||(a[t].item={text:a[t].title,menu:[]}),w=a[t].item.menu;break}}}j.formatter.register(u,v);var s=tinymce.extend({},e.settings.itemDefaults,{text:v.title,format:u});w?w.push(s):e.add(s)}h[r]=!0}}),k(a,function(b){e.add(b.item)}),d.control.renderNew()}),l.convertSelectorToFormat=m});