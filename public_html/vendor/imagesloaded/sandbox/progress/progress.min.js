var progressElem,statusElem;var supportsProgress;var loadedImageCount,imageCount;var container=document.querySelector("#image-container");statusElem=document.querySelector("#status");progressElem=document.querySelector("progress");supportsProgress=progressElem&&progressElem.toString().indexOf("Unknown")===-1;document.querySelector("#add").onclick=function(){var a=getItemsFragment();container.insertBefore(a,container.firstChild);var b=imagesLoaded(container);b.on("progress",onProgress);b.on("always",onAlways);imageCount=b.images.length;resetProgress();updateProgress(0)};document.querySelector("#reset").onclick=function(){empty(container)};var docElem=document.documentElement;var textSetter=docElem.textContent!==undefined?"textContent":"innerText";function setText(a,b){a[textSetter]=b}function empty(a){while(a.firstChild){a.removeChild(a.firstChild)}}function getItemsFragment(){var a=document.createDocumentFragment();for(var b=0;b<7;b++){var c=getImageItem();a.appendChild(c)}return a}function getImageItem(){var e=document.createElement("li");e.className="is-loading";var b=document.createElement("img");var c=Math.random()*3+1;var d=Math.random()*110+100;d=Math.round(d*c);var a=Math.round(140*c);var f=Math.ceil(Math.random()*1000);b.src=f<100?"//foo/broken-"+f+".jpg":"//lorempixel.com/"+d+"/"+a+"/?"+f;e.appendChild(b);return e}function resetProgress(){statusElem.style.opacity=1;loadedImageCount=0;if(supportsProgress){progressElem.setAttribute("max",imageCount)}}function updateProgress(a){if(supportsProgress){progressElem.setAttribute("value",a)}else{setText(statusElem,a+" / "+imageCount)}}function onProgress(b,a){a.img.parentNode.className=a.isLoaded?"":"is-broken";loadedImageCount++;updateProgress(loadedImageCount)}function onAlways(){statusElem.style.opacity=0};