(function(d){var c=jQuery.fn;jQuery.extend(true,c,{rsWhiteBoard:function(k){return this.each(function(){var l=this.opt;jQuery(this).on("revolution.slide.onloaded",function(){j(l)})})}});var j=function(l){o=l.whiteboard;if(o===undefined){return false}var m="position:absolute;z-index:1000;top:0px;left:0px;",k="position:absolute;z-index:1000;top:0px;left:0px;",p="position:absolute;z-index:1000;top:0px;left:0px;",n="position:absolute; top:0px;left:0px;background-size:contain;background-repeat:no-repeat;background-position:center center;";if(o.movehand!=undefined){o.movehand.markup='<div class="wb-move-hand wb-thehand" style="'+m+'"><div class="wb-hand-inner" style="'+k+";width:"+o.movehand.width+"px;height:"+o.movehand.height+'px"><div class="wb-hand-scale" ><div class="wb-hand-image" style="'+n+"width:"+o.movehand.width+"px;height:"+o.movehand.height+"px;background-image:url("+o.movehand.src+');"></div></div></div>'}if(o.writehand!=undefined){o.writehand.markup='<div class="wb-draw-hand wb-thehand" style="'+m+'"><div class="wb-hand-inner" style="'+k+'"><div class="wb-hand-scale" style="'+p+'"><div class="wb-hand-image" style="'+n+"width:"+o.writehand.width+"px;height:"+o.writehand.height+"px;background-image:url("+o.writehand.src+');"></div></div></div>'}jQuery(window).resize(function(){clearTimeout(l.whiteboard_resize_timer);l.whiteboard_resize_timer=setTimeout(function(){jQuery(".wb-thehand").each(function(){var q=jQuery(this).find(".wb-hand-scale");punchgs.TweenLite.set(q,{scale:l.bw})})},50)});l.c.on("revolution.slide.onbeforeswap",function(q,r){l.c.find(".wb-thehand").remove()});l.c.on("revolution.layeraction",function(s,v){var u=v.layersettings.whiteboard;if(u!=undefined){if(u.configured!=true){if(u.hand_function=="write"||u.hand_function=="draw"){u.jitter_distance=u.jitter_distance!=undefined?parseInt(u.jitter_distance,0)/100:parseInt(o.writehand.jittering.distance,0)/100;u.jitter_distance_horizontal=u.jitter_distance_horizontal!=undefined?parseInt(u.jitter_distance_horizontal,0)/100:parseInt(o.writehand.jittering.distance_horizontal,0)/100;u.jitter_offset=u.jitter_offset!=undefined?parseInt(u.jitter_offset,0)/100:parseInt(o.writehand.jittering.offset,0)/100;u.jitter_offset_horizontal=u.jitter_offset_horizontal!=undefined?parseInt(u.jitter_offset_horizontal,0)/100:parseInt(o.writehand.jittering.offset_horizontal,0)/100;u.hand_type=u.hand_type||o.writehand.handtype}if(u.hand_function=="move"){u.hand_type=u.hand_type||o.movehand.handtype}u.configured=true}var q=v.layer.data(),r=jQuery(q._pw).find(".wb-thehand");if(r.length>0){var t=r.data("wb")}else{var t=jQuery.extend(true,{},v.layersettings.whiteboard)}if(v.eventtype=="enterstage"){if(jQuery(v.layer).is(":visible")===false){return}if(!v.layer.hasClass("handadded")){v.layer.addClass("handadded");v.layersettings.handEffect="on";if(t.handadded!=true){b(l,v,t)}h(v,t)}}if(v.eventtype=="enteredstage"){if(v.layer.hasClass("handadded")&&!v.layer.hasClass("handremoved")){v.layer.addClass("handremoved");v.layersettings.handEffect="off";if(e(l,v,t)==false){f(l,v,t)}}}if(v.eventtype=="leavestage"){v.layer.removeClass("handadded");v.layer.removeClass("handremoved")}}})};var g=function(m){var k={},l=m.layer.data();k.obj="";k.startat=9999999;jQuery(l._li).find(".tp-caption").each(function(){var p=jQuery(this),n=p.data();if(n.active!=true&&n.whiteboard!=undefined&&n.whiteboard.hand_function!="move"){if(parseInt(n.frames[0].delay,0)<k.startat){k.obj=p;k.startat=parseInt(n.frames[0].delay,0)}}});return k};var e=function(m,u,r){var v=false,x=u.layer.data(),t=jQuery(x._pw).find(".wb-thehand");if(x.whiteboard.goto_next_layer==="on"&&x.whiteboard.hand_function!="move"&&m.c.find(".wb-between-stations").length==0){var q=g(u);if(q!=undefined&&q.obj.length>0){var n=t.find(".wb-hand-inner"),k=x.timeline!=undefined&&x.timeline._labels!=undefined&&x.timeline._labels.frame_0_end!=undefined?x.timeline._labels.frame_0_end:0,y=q.startat/1000-k,w=jQuery(x._pw).position(),p=q.obj.data("_pw").position(),l=t.closest(".tp-static-layers").length>0?true:false;t.appendTo(m.ul);t.addClass("wb-between-stations");if(l){t.css({zIndex:200})}else{t.css({zIndex:100})}r.handEffect="off";punchgs.TweenLite.fromTo(t,y,{top:w.top,left:w.left},{top:p.top,left:p.left});punchgs.TweenLite.to(n,y,{x:0,y:0,onComplete:function(){t.remove()}});v=true}}return v};var a=function(n,q,m){if(m.handEffect=="off"||m.handadded!=true){return}var k=q.layer.data(),p=m.maxwave||k.eoh,l=parseInt(m.hand_angle,0)||10;ro=m.hand_function=="write"||m.hand_function=="draw"?Math.random()*l-(l/2):0;m.rotatespeed=m.rotatespeed||0.05;m.rotating_anim=punchgs.TweenLite.to(n,m.rotatespeed,{rotationZ:ro,ease:punchgs.Power3.easeOut,onComplete:function(){a(n,q,m)}})};var i=function(n,q,m){if(m.handEffect=="off"||m.handadded!=true){return}var k=q.layer.data();if(m.jitter_direction=="horizontal"){var r=m.maxwave||k.eow*m.jitter_distance_horizontal,l=k.eow*m.jitter_offset_horizontal;if(r==0){return}m.current_x_offset=m.current_x_offset||0;m.lastwave=Math.random()*r+l;m.jitterspeed=m.jitterspeed||0.05;m.jittering_anim=punchgs.TweenLite.to(n,m.jitterspeed,{x:m.lastwave,ease:punchgs.Power3.easeOut,onComplete:function(){i(n,q,m)}})}else{var p=m.maxwave||k.eoh;if(p==0){return}m.current_y_offset=m.current_y_offset||0;m.lastwave=m.lastwave==m.current_y_offset+(p*m.jitter_offset)?Math.random()*(p*m.jitter_distance)+m.current_y_offset+(p*m.jitter_offset):m.current_y_offset+(p*m.jitter_offset);m.jitterspeed=m.jitterspeed||0.05;m.jittering_anim=punchgs.TweenLite.to(n,m.jitterspeed,{y:m.lastwave,ease:punchgs.Power3.easeOut,onComplete:function(){i(n,q,m)}})}};var b=function(k,q,n){var l=n.hand_function=="move"?k.whiteboard.movehand:k.whiteboard.writehand,r=l.markup,t=q.layer.data();n.hand_full_rotation=n.hand_full_rotation||0;n.hand_origin=l.transform.transformX+"px "+l.transform.transformY+"px";n.hand_scale=n.hand_type=="right"?1:-1;n.hand_x_offset=parseInt(n.hand_x_offset,0)||0;n.hand_y_offset=parseInt(n.hand_y_offset,0)||0;jQuery(r).appendTo(jQuery(t._pw));n.handadded=true;var p=jQuery(t._pw).find(".wb-thehand"),m=p.find(".wb-hand-inner"),s=p.find(".wb-hand-image");punchgs.TweenLite.set(s,{scaleX:n.hand_scale,rotation:n.hand_full_rotation,transformOrigin:n.hand_origin,x:0-l.transform.transformX+n.hand_x_offset,y:0-l.transform.transformY+n.hand_y_offset});punchgs.TweenLite.set(p.find(".wb-hand-scale"),{scale:k.bw,transformOrigin:"0% 0%"})};var h=function(r,p){var x=r.layer.data(),q=jQuery(x._pw).find(".wb-thehand"),n=q.find(".wb-hand-inner"),u=q.find(".wb-hand-image"),A=punchgs.TweenLite.getTweensOf(r.layer);switch(p.hand_function){case"write":case"draw":var B=x.frames[r.frame_index].speed/1000;if(x.splittext!=undefined&&x.splittext!="none"){p.tweens=r.layersettings.timeline.getChildren(true,true,false);jQuery.each(p.tweens,function(C,s){s.eventCallback("onStart",function(F,H,G){var D=jQuery(this.target),Q=D.width(),I=D.height();if(D!==undefined&&D.html()!==undefined&&D.html().length>0&&D.html().charCodeAt(0)!=9&&D.html().charCodeAt(0)!=10){var N=D.position(),P=D.parent(),L=P.parent(),J=G.hand_function=="write"?Math.random()*10-5:0,E=this._duration,O=N.left,M=N.top;if(P.hasClass("tp-splitted")){O=P.position().left+O;M=P.position().top+M}if(L.hasClass("tp-splitted")){O=L.position().left+O;M=L.position().top+M}G.rotatespeed=G.hand_angle_repeat!==undefined?(parseFloat(E)/parseFloat(G.hand_angle_repeat)):E>1?E/6:E>0.5?E/6:E/3;G.jitterspeed=G.jitter_repeat!==undefined?(parseFloat(E)/parseFloat(G.jitter_repeat)):E>1?E/6:E>0.5?E/6:E/3;if(G.current_y_offset!=M){E=0.1}G.current_y_offset=M||0;G.maxwave=I;if(C<G.tweens.length-1){punchgs.TweenLite.to(F,E,{x:O+Q})}else{punchgs.TweenLite.to(F,E,{x:O+Q,onComplete:function(){G.handEffect="off";try{G.jittering_anim.kill(false)}catch(R){}}})}}else{G.current_y_offset=0;G.maxwave=I;G.handEffect="off";try{G.jittering_anim.kill(false)}catch(K){}}},[n,r,p])})}else{var w=(x.eow*p.jitter_distance_horizontal),v=(x.eow*p.jitter_offset_horizontal),l=(x.eoh*p.jitter_distance),k=(x.eoh*p.jitter_offset);p.rotatespeed=p.hand_angle_repeat!==undefined?(parseFloat(B)/parseFloat(p.hand_angle_repeat)):B>1?B/6:B>0.5?B/6:B/3;p.jitterspeed=p.jitter_repeat!==undefined?(parseFloat(B)/parseFloat(p.jitter_repeat)):B>1?B/6:B>0.5?B/6:B/3;if(p.hand_direction=="right_to_left"){var y=x.eow-v,m=y-w;punchgs.TweenLite.fromTo(n,B,{x:y},{x:m,ease:r.layersettings.frames[0].ease,onComplete:function(){p.handEffect="off"}})}else{if(p.hand_direction=="top_to_bottom"){var t=k,z=t+l;punchgs.TweenLite.fromTo(n,B,{y:t},{y:z,ease:r.layersettings.frames[0].ease,onComplete:function(){p.handEffect="off"}});p.jitter_direction="horizontal"}else{if(p.hand_direction=="bottom_to_top"){var t=x.eoh-k,z=t-l;punchgs.TweenLite.fromTo(n,B,{y:t},{y:z,ease:r.layersettings.frames[0].ease,onComplete:function(){p.handEffect="off"}});p.jitter_direction="horizontal"}else{var y=v,m=y+w;punchgs.TweenLite.fromTo(n,B,{x:y},{x:m,ease:r.layersettings.frames[0].ease,onComplete:function(){p.handEffect="off"}})}}}}i(n,r,p);a(n,r,p);break;case"move":q.data("outspeed",r.layersettings.frames[r.layersettings.frames.length-1].speed/1000);q.data("outease",r.layersettings.frames[r.layersettings.frames.length-1].ease);A[0].eventCallback("onUpdate",function(D){var C=this.target.style,s=this.target._gsTransform,E={};E.x=s.x;E.y=s.y;if(q.data("pos")===undefined){q.data("pos",E)}p.hand_inner_animation=punchgs.TweenLite.set(q,{x:E.x,y:E.y})},[r]);break}q.data("wb",p)};var f=function(m,q,n){var s=q.layer.data(),p=jQuery(s._pw).find(".wb-thehand"),v=p.data("pos")||{x:0,y:0},w=p.position()||{top:0,left:0},l=s.frames[q.layersettings.frames.length-1].speed/1000||2,u=s.frames[q.layersettings.frames.length-1].ease,t=v.x==0&&v.y==0?0:1;l=l*0.5;if(n.hand_function!="move"){var r=jQuery(s._pw).position(),k=m.c.offset();w.left=n.hand_type=="right"?m.c.width()-r.left+s.eow:0-r.left-s.eow;w.top=m.c.height()}punchgs.TweenLite.to(p,l,{top:w.top,left:w.left,autoAlpha:t,x:v.x,y:v.y,ease:u,onComplete:function(){p.remove();n.handadded=false}})}})(jQuery);